
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>ksnowlv</title>
  <meta name="author" content="律威">

  
  <meta name="description" content="一.下载apache-maven-3.6.3见：Maven官网 把apache-maven-3.6.3放置到/Users/用户名/目录下 二.配置环境变量 打开.bash_profile文件，配置如下： export MAVENDIR=/Users/ksnowlv/apache-maven-3.6 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://ksnowlv.github.io">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="ksnowlv" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.useso.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.useso.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.useso.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
     _gaq.push(['_setAccount', 'UA-39546615-2']);
    // _gaq.push(['_trackPageview']);

    // (function() {
    //   var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    //   ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    //   var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    // })();

    _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src='http://droidyue-tools.qiniudn.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">ksnowlv</a></h1>
  
    <h2>回顾过去,总结以往;立足现在,铭记当下;技术为主,笔记而已.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:ksnowlv.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">博客首页</a></li>
  <li><a href="/blog/archives">文章列表</a></li>
  <li><a href="/about-me">关于我</a></li>

</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/11/29/macan-zhuang-maven/">Mac安装Maven</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2019-11-29T14:03:00+08:00" pubdate data-updated="true">Nov 29<span>th</span>, 2019</time>
        
         | <a href="/blog/2019/11/29/macan-zhuang-maven/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h4>一.下载<a href="http://ftp.wayne.edu/apache/maven/maven-3/3.6.3/binaries/apache-maven-3.6.3-bin.tar.gz">apache-maven-3.6.3</a>见：<a href="http://maven.apache.org/download.cgi">Maven官网</a></h4>

<p>把<code>apache-maven-3.6.3</code>放置到<code>/Users/用户名/</code>目录下</p>

<h4>二.配置环境变量</h4>

<p>打开<code>.bash_profile</code>文件，配置如下：</p>

<pre><code>export MAVENDIR=/Users/ksnowlv/apache-maven-3.6.3
export PATH=$PATH:$MAVENDIR/bin:$PATH
</code></pre>

<p>使用source ~/.bash_profile命令使环境变量生效</p>

<h3>三.测试是否安装成功</h3>

<p>使用<code>mvn -v</code>命名测试</p>

<h5>1.若成功输出如下内容</h5>

<pre><code>ksnowlvdeMacBook-Pro:QUICTest ksnowlv$ mvn -version
Picked up JAVA_TOOL_OPTIONS: -Dfile.encoding=UTF-8
Apache Maven 3.6.3 (cecedd343002696d0abb50b32b541b8a6ba2883f)
Maven home: /Users/ksnowlv/apache-maven-3.6.3
Java version: 12, vendor: Oracle Corporation, runtime: /Library/Java/   JavaVirtualMachines/jdk-12.jdk/Contents/Home
Default locale: zh_CN_#Hans, platform encoding: UTF-8
OS name: "mac os x", version: "10.15", arch: "x86_64", family: "mac"
</code></pre>

<h5>2.若失败，如下内容，更新下JAVA_HOME目录即可。</h5>

<pre><code>The JAVA_HOME environment variable is not defined correctly
This environment variable is needed to run this program
NB: JAVA_HOME should point to a JDK not a JRE
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/11/28/iosshi-pin-bo-fang-avplayerviewcontroller/">iOS视频播放AVPlayerViewController</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2019-11-28T10:31:00+08:00" pubdate data-updated="true">Nov 28<span>th</span>, 2019</time>
        
         | <a href="/blog/2019/11/28/iosshi-pin-bo-fang-avplayerviewcontroller/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>AVPlayerViewController播放视频分两种形式</p>

<ul>
<li>内嵌视图的形式显示</li>
<li>模态视图的形式显示</li>
</ul>


<h4>一.初始化AVPlayerViewController</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'> <span class="n">func</span> <span class="n">loadPlayer</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">guard</span> <span class="n">let</span> <span class="n">movieUrl</span> <span class="o">=</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">path</span><span class="p">(</span><span class="nl">forResource:</span> <span class="s">&quot;zh-zhfanti-en&quot;</span><span class="p">,</span> <span class="nl">ofType:</span> <span class="s">&quot;m4v&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">let</span> <span class="n">player</span> <span class="o">=</span> <span class="n">AVPlayer</span><span class="p">(</span><span class="nl">url:</span> <span class="n">URL</span><span class="p">(</span><span class="nl">fileURLWithPath:</span> <span class="n">movieUrl</span><span class="p">))</span>
</span><span class='line'>        <span class="n">playerViewController</span> <span class="o">=</span> <span class="n">AVPlayerViewController</span><span class="p">()</span>
</span><span class='line'>        <span class="n">playerViewController</span><span class="o">!</span><span class="p">.</span><span class="n">player</span> <span class="o">=</span> <span class="n">player</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<h4>二.内嵌视图的形式显示</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'> <span class="err">@</span><span class="kt">IBAction</span> <span class="n">func</span> <span class="n">handlePlayInViewEvent</span><span class="p">(</span><span class="nl">sender:</span> <span class="n">AnyObject</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">loadPlayer</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">guard</span> <span class="p">(</span><span class="n">playerViewController</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">containerView</span><span class="o">?</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">playerViewController</span><span class="o">!</span><span class="p">.</span><span class="n">view</span><span class="p">)</span>
</span><span class='line'>        <span class="n">playerViewController</span><span class="o">?</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">containerView</span><span class="o">!</span><span class="p">.</span><span class="n">bounds</span>
</span><span class='line'>        <span class="n">self</span><span class="p">.</span><span class="n">addChild</span><span class="p">(</span><span class="n">playerViewController</span><span class="o">!</span><span class="p">)</span>
</span><span class='line'>        <span class="n">playerViewController</span><span class="o">?</span><span class="p">.</span><span class="n">player</span><span class="o">?</span><span class="p">.</span><span class="n">play</span><span class="p">()</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>效果图如下：</p>

<p>点击<code>AVPlayerViewController</code>可以全屏播放</p>

<h4>三.模态视图的形式显示</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="err">@</span><span class="kt">IBAction</span> <span class="n">func</span> <span class="n">handlePlayWithModelViewEvent</span><span class="p">(</span><span class="nl">sender:</span> <span class="n">AnyObject</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">loadPlayer</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">guard</span> <span class="p">(</span><span class="n">playerViewController</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="n">self</span><span class="p">.</span><span class="n">present</span><span class="p">(</span><span class="n">playerViewController</span><span class="o">!</span><span class="p">,</span> <span class="nl">animated:</span> <span class="n">true</span><span class="p">)</span> <span class="p">{</span> <span class="p">[</span><span class="n">weak</span> <span class="n">self</span><span class="p">]</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
</span><span class='line'>        <span class="n">guard</span> <span class="n">let</span> <span class="n">self</span> <span class="o">=</span> <span class="n">self</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="n">self</span><span class="p">.</span><span class="n">playerViewController</span><span class="o">?</span><span class="p">.</span><span class="n">player</span><span class="o">?</span><span class="p">.</span><span class="n">play</span><span class="p">()</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>效果图如下：</p>

<h3>四.停止视频播放</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'> <span class="err">@</span><span class="kt">IBAction</span> <span class="n">func</span> <span class="n">handleStopPlayEvent</span><span class="p">(</span><span class="nl">sender:</span> <span class="n">AnyObject</span><span class="o">?</span> <span class="p">){</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">guard</span> <span class="n">playerViewController</span> <span class="o">!=</span> <span class="nb">nil</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="p">((</span><span class="n">playerViewController</span><span class="o">?</span><span class="p">.</span><span class="n">parent</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">playerViewController</span><span class="o">?</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">removeFromSuperview</span><span class="p">()</span>
</span><span class='line'>            <span class="n">playerViewController</span><span class="o">?</span><span class="p">.</span><span class="n">removeFromParent</span><span class="p">()</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">playerViewController</span> <span class="o">!=</span> <span class="nb">nil</span> <span class="o">&amp;&amp;</span> <span class="n">playerViewController</span><span class="o">!</span><span class="p">.</span><span class="n">isModalInPresentation</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">playerViewController</span><span class="o">?</span><span class="p">.</span><span class="n">dismiss</span><span class="p">(</span><span class="nl">animated:</span> <span class="p">(</span><span class="n">sender</span> <span class="o">!=</span> <span class="nb">nil</span> <span class="o">?</span> <span class="nl">true:</span><span class="n">false</span><span class="p">),</span> <span class="nl">completion:</span> <span class="nb">nil</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">playerViewController</span><span class="o">?</span><span class="p">.</span><span class="n">player</span><span class="o">?</span><span class="p">.</span><span class="n">pause</span><span class="p">()</span>
</span><span class='line'>        <span class="n">playerViewController</span> <span class="o">=</span> <span class="nb">nil</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/11/26/iosshi-pin-bo-fang-avplayer/">iOS视频播放-AVPlayer和AVPlayerLayer</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2019-11-26T17:13:00+08:00" pubdate data-updated="true">Nov 26<span>th</span>, 2019</time>
        
         | <a href="/blog/2019/11/26/iosshi-pin-bo-fang-avplayer/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>本文计划使用<code>AVPlayer</code>和<code>AVPlayerLayer</code>播放视频格式</p>

<ul>
<li>m4v:MP4的特殊类型，MP4格式的高清；可包含字幕</li>
<li>mp4：音频、视频信息的压缩编码标准。</li>
<li>srt：字幕文件格式</li>
</ul>


<h4>一.播放m4v格式</h4>

<p>可通过MP4格式的文件+字幕文件合成m4v格式，可用<a href="https://www.macupdate.com/app/mac/31647/subler">Subler</a>工具合成</p>

<p><img src="/images/post/2019-11-26-iosshi-pin-bo-fang-avplayer/Subler.jpg" alt="image" /></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'> <span class="n">func</span> <span class="nf">playMovieFromLocalFile</span><span class="p">(</span><span class="nl">fileFullName:</span> <span class="n">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Bool</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">guard</span> <span class="n">FileManager</span><span class="p">.</span><span class="k">default</span><span class="p">.</span><span class="n">fileExists</span><span class="p">(</span><span class="nl">atPath:</span> <span class="n">fileFullName</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">debugPrint</span><span class="p">(</span><span class="s">&quot;\(fileFullName) not Found&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">false</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">//加载视频文件资源（包括视频与所有字幕）</span>
</span><span class='line'>        <span class="n">let</span> <span class="n">asset</span> <span class="o">=</span> <span class="n">AVAsset</span><span class="p">(</span><span class="nl">url:</span> <span class="n">URL</span><span class="p">(</span><span class="nl">fileURLWithPath:</span> <span class="n">fileFullName</span><span class="p">))</span>
</span><span class='line'>        <span class="n">let</span> <span class="n">playerItem</span> <span class="o">=</span> <span class="n">AVPlayerItem</span><span class="p">(</span><span class="nl">asset:</span> <span class="n">asset</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">//视频文件中所有支持的字幕</span>
</span><span class='line'>        <span class="k">for</span> <span class="n">characteristic</span> <span class="k">in</span> <span class="n">asset</span><span class="p">.</span><span class="n">availableMediaCharacteristicsWithMediaSelectionOptions</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">debugPrint</span><span class="p">(</span><span class="s">&quot;\(characteristic)&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">if</span> <span class="n">let</span> <span class="n">group</span> <span class="o">=</span> <span class="n">asset</span><span class="p">.</span><span class="n">mediaSelectionGroup</span><span class="p">(</span><span class="nl">forMediaCharacteristic:</span> <span class="n">characteristic</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">for</span> <span class="n">option</span> <span class="k">in</span> <span class="n">group</span><span class="p">.</span><span class="n">options</span> <span class="p">{</span>
</span><span class='line'>                    <span class="n">debugPrint</span><span class="p">(</span><span class="s">&quot;  Option: \(option.displayName)&quot;</span><span class="p">)</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="n">let</span> <span class="n">group</span> <span class="o">=</span> <span class="n">asset</span><span class="p">.</span><span class="n">mediaSelectionGroup</span><span class="p">(</span><span class="nl">forMediaCharacteristic:</span> <span class="n">AVMediaCharacteristic</span><span class="p">.</span><span class="n">legible</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">let</span> <span class="n">locale</span> <span class="o">=</span> <span class="n">Locale</span><span class="p">(</span><span class="nl">identifier:</span> <span class="s">&quot;zh&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="n">let</span> <span class="n">options</span> <span class="o">=</span>
</span><span class='line'>                <span class="n">AVMediaSelectionGroup</span><span class="p">.</span><span class="n">mediaSelectionOptions</span><span class="p">(</span><span class="nl">from:</span> <span class="n">group</span><span class="p">.</span><span class="n">options</span><span class="p">,</span> <span class="nl">with:</span> <span class="n">locale</span><span class="p">)</span>
</span><span class='line'>            <span class="k">if</span> <span class="n">let</span> <span class="n">option</span> <span class="o">=</span> <span class="n">options</span><span class="p">.</span><span class="n">first</span> <span class="p">{</span>
</span><span class='line'>                <span class="c1">// 如果支持中文，默认选中中文字幕</span>
</span><span class='line'>                <span class="n">playerItem</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="k">in</span><span class="o">:</span> <span class="n">group</span><span class="p">)</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">player</span> <span class="o">=</span> <span class="n">AVPlayer</span><span class="p">(</span><span class="nl">playerItem:</span> <span class="n">playerItem</span><span class="p">)</span>
</span><span class='line'>        <span class="n">player</span><span class="o">?</span><span class="p">.</span><span class="n">appliesMediaSelectionCriteriaAutomatically</span> <span class="o">=</span> <span class="n">false</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="n">playerLayer</span> <span class="o">==</span> <span class="nb">nil</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">playerLayer</span> <span class="o">=</span> <span class="n">AVPlayerLayer</span><span class="p">(</span><span class="nl">player:</span> <span class="n">player</span><span class="p">)</span>
</span><span class='line'>            <span class="n">playerLayer</span><span class="o">?</span><span class="p">.</span><span class="n">videoGravity</span> <span class="o">=</span> <span class="n">AVLayerVideoGravity</span><span class="p">.</span><span class="n">resizeAspectFill</span>
</span><span class='line'>            <span class="n">playerContainerView</span><span class="o">?</span><span class="p">.</span><span class="n">layer</span><span class="p">.</span><span class="n">addSublayer</span><span class="p">(</span><span class="n">playerLayer</span><span class="o">!</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">setupPlayerObserverEvent</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="n">true</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="n">override</span> <span class="n">func</span> <span class="n">viewDidAppear</span><span class="p">(</span><span class="n">_</span> <span class="nl">animated:</span> <span class="n">Bool</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">playerLayer</span><span class="o">?</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">playerContainerView</span><span class="o">!</span><span class="p">.</span><span class="n">bounds</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>效果图如下：</p>

<p><img src="/images/post/2019-11-26-iosshi-pin-bo-fang-avplayer/overview_1.png" alt="image" /></p>

<h4>二.播放mp4格式带srt字幕</h4>

<p><code>mp4</code>文件和字幕<code>srt</code>文件通过时间軕实现当前播放进度展示相应文本。
srt格式解析可参考<a href="https://github.com/mhergon/AVPlayerViewController-Subtitles">AVPlayerViewController-Subtitles</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'>
</span><span class='line'>  <span class="n">func</span> <span class="n">playMovie</span><span class="p">(</span><span class="nl">movieFile:</span> <span class="n">String</span><span class="p">,</span> <span class="nl">captionFile:</span> <span class="n">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Bool</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">let</span> <span class="n">fileManage</span> <span class="o">=</span> <span class="n">FileManager</span><span class="p">.</span><span class="k">default</span>
</span><span class='line'>        <span class="n">guard</span> <span class="n">fileManage</span><span class="p">.</span><span class="n">fileExists</span><span class="p">(</span><span class="nl">atPath:</span> <span class="n">movieFile</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">fileManage</span><span class="p">.</span><span class="n">fileExists</span><span class="p">(</span><span class="nl">atPath:</span> <span class="n">captionFile</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">debugPrint</span><span class="p">(</span><span class="s">&quot;movie:\(movieFile)/ or captionFile:\(captionFile)not found&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">false</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">//加载视频文件</span>
</span><span class='line'>        <span class="n">player</span> <span class="o">=</span>  <span class="n">AVPlayer</span><span class="p">(</span><span class="nl">url:</span> <span class="n">URL</span><span class="p">(</span><span class="nl">fileURLWithPath:</span> <span class="n">movieFile</span><span class="p">))</span>
</span><span class='line'>        <span class="c1">//加载视频文件对应字幕文件</span>
</span><span class='line'>        <span class="n">parser</span> <span class="o">=</span> <span class="n">Subtitles</span><span class="p">(</span><span class="nl">file:</span> <span class="n">URL</span><span class="p">(</span><span class="nl">fileURLWithPath:</span> <span class="n">captionFile</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">//创建AVPlayerLayer并加入到视图层中</span>
</span><span class='line'>        <span class="n">playerLayer</span> <span class="o">=</span> <span class="n">AVPlayerLayer</span><span class="p">(</span><span class="nl">player:</span> <span class="n">player</span><span class="p">)</span>
</span><span class='line'>        <span class="n">playerLayer</span><span class="o">!</span><span class="p">.</span><span class="n">videoGravity</span> <span class="o">=</span> <span class="n">AVLayerVideoGravity</span><span class="p">.</span><span class="n">resizeAspectFill</span>
</span><span class='line'>        <span class="n">playerContainerView</span><span class="o">?</span><span class="p">.</span><span class="n">layer</span><span class="p">.</span><span class="n">addSublayer</span><span class="p">(</span><span class="n">playerLayer</span><span class="o">!</span><span class="p">)</span>
</span><span class='line'>        <span class="n">setupPlayerObserverEvent</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="n">true</span>
</span><span class='line'>    <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>  效果图如下：</p>

<p><img src="/images/post/2019-11-26-iosshi-pin-bo-fang-avplayer/overview_2.png" alt="image" /></p>

<h4>三.两种方式需要手动播放或暂停</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'>
</span><span class='line'>    <span class="err">@</span><span class="kt">IBAction</span> <span class="n">func</span> <span class="n">handleStartPlayerEvent</span><span class="p">(</span><span class="nl">sender:</span> <span class="n">AnyObject</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">isPlaying</span> <span class="o">=</span> <span class="n">true</span>
</span><span class='line'>        <span class="n">player</span><span class="o">?</span><span class="p">.</span><span class="n">play</span><span class="p">()</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="err">@</span><span class="kt">IBAction</span> <span class="n">func</span> <span class="n">handlePausePlayerEvent</span><span class="p">(</span><span class="nl">sender:</span> <span class="n">AnyObject</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="n">isPlaying</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">player</span><span class="o">?</span><span class="p">.</span><span class="n">pause</span><span class="p">()</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>详细参考<a href="https://github.com/ksnowlv/MoviePlayerTest">源代码</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/08/19/xcodeshi-yong-pmdsao-miao-zhong-fu-dai-ma/">XCode使用PMD扫描重复代码（一）</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2019-08-19T15:39:00+08:00" pubdate data-updated="true">Aug 19<span>th</span>, 2019</time>
        
         | <a href="/blog/2019/08/19/xcodeshi-yong-pmdsao-miao-zhong-fu-dai-ma/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>如何使用PMD在Xcode下扫描重复代码（Copy&amp;Past）呢？</p>

<h3>1.下载PMD：<a href="https://pmd.github.io">https://pmd.github.io</a>，放置到工程主目录下面。</h3>

<p><img src="/images/post/2019-08-19-xcodeshi-yong-pmdsao-miao-zhong-fu-dai-ma/1.png" alt="image" /></p>

<h3>2.Xcode中检测脚本配置</h3>

<h4>1.在<code>Xcode</code>的 <code>Build Phases</code> 中，我们增加一个新的 <code>Run Script</code>，脚本内容如下：</h4>

<pre><code>#检测swift代码
#pmd cpd --files ${EXECUTABLE_NAME} --minimum-tokens 50 --language swift --encoding UTF-8 --format net.sourceforge.pmd.cpd.XMLRenderer &gt; cpd-output.xml --failOnViolation true

#检测objective-c代码
pmd cpd --files ${EXECUTABLE_NAME} --minimum-tokens 20 --language objectivec --encoding UTF-8 --format net.sourceforge.pmd.cpd.XMLRenderer &gt; cpd-output.xml --failOnViolation true

# Running script
php ./cpd_script.php -cpd-xml cpd-output.xml
</code></pre>

<h4>2.在工程主目录下，创建cpd_script.php文件</h4>

<p>！！！需要安装好php</p>

<pre><code>&lt;?php
foreach (simplexml_load_file('cpd-output.xml')-&gt;duplication as $duplication) {
    $files = $duplication-&gt;xpath('file');
    foreach ($files as $file) {
        echo $file['path'].':'.$file['line'].':1: warning: '.$duplication['lines'].' copy-pasted lines from: '
            .implode(', ', array_map(function ($otherFile) { return $otherFile['path'].':'.$otherFile['line']; },
            array_filter($files, function ($f) use (&amp;$file) { return $f != $file; }))).PHP_EOL;
    }
}
?&gt;
</code></pre>

<p><img src="/images/post/2019-08-19-xcodeshi-yong-pmdsao-miao-zhong-fu-dai-ma/2.jpg" alt="image" /></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/05/22/flutter-cannot-create-a-project-within-the-flutter-sdk/">flutter创建工程报错:Cannot Create a Project Within the Flutter SDK. Target Directory &#8216;X&#8217; Is Within the Flutter SDK at&#8217;/Users/x/Music/flutter/flutter&#8217;</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2019-05-22T11:13:00+08:00" pubdate data-updated="true">May 22<span>nd</span>, 2019</time>
        
         | <a href="/blog/2019/05/22/flutter-cannot-create-a-project-within-the-flutter-sdk/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>在使用 <code>flutter create</code>命令创建<code>flutter</code>工程时，如果报<code>Cannot create a project within the Flutter SDK. Target directory '/Users/ksnowlv/Music/flutter/flutter/my_app' is within the Flutter SDK at
'/Users/ksnowlv/Music/flutter/flutter'的错误，</code>注意不要在<code>flutter SDK</code>目录及子目录下创建工程，可考虑在其它目录下创建工程。例如平级目录</p>

<pre><code>ksnowlvdeMacBook-Pro:flutter ksnowlv$ ./flutter/bin/flutter create my_app
Creating project my_app...
  my_app/ios/Runner.xcworkspace/contents.xcworkspacedata (created)
  my_app/ios/Runner/Info.plist (created)
  my_app/ios/Runner/Assets.xcassets/LaunchImage.imageset/LaunchImage@2x.png (created)
  my_app/ios/Runner/Assets.xcassets/LaunchImage.imageset/LaunchImage@3x.png (created)
  my_app/ios/Runner/Assets.xcassets/LaunchImage.imageset/README.md (created)
  my_app/ios/Runner/Assets.xcassets/LaunchImage.imageset/Contents.json (created)
  my_app/ios/Runner/Assets.xcassets/LaunchImage.imageset/LaunchImage.png (created)
  my_app/ios/Runner/Assets.xcassets/AppIcon.appiconset/Icon-App-76x76@2x.png (created)
  my_app/ios/Runner/Assets.xcassets/AppIcon.appiconset/Icon-App-29x29@1x.png (created)
  my_app/ios/Runner/Assets.xcassets/AppIcon.appiconset/Icon-App-40x40@1x.png (created)
  my_app/ios/Runner/Assets.xcassets/AppIcon.appiconset/Icon-App-20x20@1x.png (created)
  my_app/ios/Runner/Assets.xcassets/AppIcon.appiconset/Icon-App-1024x1024@1x.png (created)
  my_app/ios/Runner/Assets.xcassets/AppIcon.appiconset/Icon-App-83.5x83.5@2x.png (created)
  my_app/ios/Runner/Assets.xcassets/AppIcon.appiconset/Icon-App-20x20@3x.png (created)
  my_app/ios/Runner/Assets.xcassets/AppIcon.appiconset/Contents.json (created)
  my_app/ios/Runner/Assets.xcassets/AppIcon.appiconset/Icon-App-20x20@2x.png (created)
  my_app/ios/Runner/Assets.xcassets/AppIcon.appiconset/Icon-App-29x29@3x.png (created)
  my_app/ios/Runner/Assets.xcassets/AppIcon.appiconset/Icon-App-40x40@2x.png (created)
  my_app/ios/Runner/Assets.xcassets/AppIcon.appiconset/Icon-App-60x60@3x.png (created)
  my_app/ios/Runner/Assets.xcassets/AppIcon.appiconset/Icon-App-60x60@2x.png (created)
  my_app/ios/Runner/Assets.xcassets/AppIcon.appiconset/Icon-App-76x76@1x.png (created)
  my_app/ios/Runner/Assets.xcassets/AppIcon.appiconset/Icon-App-40x40@3x.png (created)
  my_app/ios/Runner/Assets.xcassets/AppIcon.appiconset/Icon-App-29x29@2x.png (created)
  my_app/ios/Runner/Base.lproj/LaunchScreen.storyboard (created)
  my_app/ios/Runner/Base.lproj/Main.storyboard (created)
  my_app/ios/Runner.xcodeproj/project.xcworkspace/contents.xcworkspacedata (created)
  my_app/ios/Runner.xcodeproj/xcshareddata/xcschemes/Runner.xcscheme (created)
  my_app/ios/Flutter/Debug.xcconfig (created)
  my_app/ios/Flutter/Release.xcconfig (created)
  my_app/ios/Flutter/AppFrameworkInfo.plist (created)
  my_app/test/widget_test.dart (created)
  my_app/my_app.iml (created)
  my_app/.gitignore (created)
  my_app/.metadata (created)
  my_app/ios/Runner/AppDelegate.h (created)
  my_app/ios/Runner/main.m (created)
  my_app/ios/Runner/AppDelegate.m (created)
  my_app/ios/Runner.xcodeproj/project.pbxproj (created)
  my_app/android/app/src/profile/AndroidManifest.xml (created)
  my_app/android/app/src/main/res/mipmap-mdpi/ic_launcher.png (created)
  my_app/android/app/src/main/res/mipmap-hdpi/ic_launcher.png (created)
  my_app/android/app/src/main/res/drawable/launch_background.xml (created)
  my_app/android/app/src/main/res/mipmap-xxxhdpi/ic_launcher.png (created)
  my_app/android/app/src/main/res/mipmap-xxhdpi/ic_launcher.png (created)
  my_app/android/app/src/main/res/values/styles.xml (created)
  my_app/android/app/src/main/res/mipmap-xhdpi/ic_launcher.png (created)
  my_app/android/app/src/main/AndroidManifest.xml (created)
  my_app/android/app/src/debug/AndroidManifest.xml (created)
  my_app/android/gradle/wrapper/gradle-wrapper.properties (created)
  my_app/android/gradle.properties (created)
  my_app/android/settings.gradle (created)
  my_app/pubspec.yaml (created)
  my_app/README.md (created)
  my_app/lib/main.dart (created)
  my_app/android/app/build.gradle (created)
  my_app/android/app/src/main/java/com/example/my_app/MainActivity.java (created)
  my_app/android/build.gradle (created)
  my_app/android/my_app_android.iml (created)
  my_app/.idea/runConfigurations/main_dart.xml (created)
  my_app/.idea/libraries/Flutter_for_Android.xml (created)
  my_app/.idea/libraries/Dart_SDK.xml (created)
  my_app/.idea/libraries/KotlinJavaRuntime.xml (created)
  my_app/.idea/modules.xml (created)
  my_app/.idea/workspace.xml (created)
Running "flutter packages get" in my_app...                         5.7s
Wrote 66 files.

All done!
[✓] Flutter is fully installed. (Channel dev, v1.6.0, on Mac OS X 10.14.4 18E226, locale zh-Hans-CN)
[!] Android toolchain - develop for Android devices is partially installed; more components are available. (Android SDK version 28.0.3)
[!] iOS toolchain - develop for iOS devices is partially installed; more components are available. (Xcode 10.2.1)
[!] Android Studio is partially installed; more components are available. (version 3.4)
[!] Connected device is not available.

Run "flutter doctor" for information about installing additional components.

In order to run your application, type:

  $ cd my_app
  $ flutter run

Your application code is in my_app/lib/main.dart.

ksnowlvdeMacBook-Pro:flutter ksnowlv$ 
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/05/22/flutteran-zhuang-he-yun-xing/">Flutter安装和运行</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2019-05-22T11:10:00+08:00" pubdate data-updated="true">May 22<span>nd</span>, 2019</time>
        
         | <a href="/blog/2019/05/22/flutteran-zhuang-he-yun-xing/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>1.创建flutter工程目录（各项目+flutter目录），在flutter 目录下载flutter SDK</h3>

<pre><code>git init
git clone -b dev https://github.com/flutter/flutter.git
</code></pre>

<h3>2.进入flutter SDK目录即flutter禁用通过 Google Analytics 发送数据</h3>

<pre><code>cd flutter
./bin/flutter config --no-analytics
</code></pre>

<p>禁用通过 Google Analytics 发送相关数据，以免国内网络连接失败问题。</p>

<h3>3.检查flutter安装情况：flutter doctor</h3>

<pre><code>ksnowlvdeMacBook-Pro:flutter ksnowlv$ ./bin/flutter doctor
Downloading Material fonts...                                       0.7s
Downloading android-arm-profile/darwin-x64 tools...                 1.3s
Downloading android-arm-release/darwin-x64 tools...                 1.2s
Downloading android-arm64-profile/darwin-x64 tools...               1.4s
Downloading android-arm64-release/darwin-x64 tools...               1.4s
Downloading android-x86 tools...                                    6.6s
Downloading android-x64 tools...                                    6.8s
Downloading android-arm tools...                                    3.1s
Downloading android-arm-profile tools...                            2.0s
Downloading android-arm-release tools...                            1.5s
Downloading android-arm64 tools...                                  3.2s
Downloading android-arm64-profile tools...                          2.1s
Downloading android-arm64-release tools...                          1.5s
Downloading ios tools...                                           16.0s
Downloading ios-profile tools...                                   11.7s
Downloading ios-release tools...                                    8.9s
Downloading Gradle Wrapper...                                       0.3s
Downloading package sky_engine...                                   1.1s
Downloading common tools...                                         4.2s
Downloading common tools...                                         4.1s
Downloading darwin-x64 tools...                                    14.0s
Doctor summary (to see all details, run flutter doctor -v):
[✓] Flutter (Channel dev, v1.6.0, on Mac OS X 10.14.4 18E226, locale zh-Hans-CN)
[!] Android toolchain - develop for Android devices (Android SDK version 28.0.3)
    ✗ Android license status unknown.
      Try re-installing or updating your Android SDK Manager.
      See https://developer.android.com/studio/#downloads or visit https://flutter.dev/setup/#android-setup for detailed instructions.
[!] iOS toolchain - develop for iOS devices
    ✗ Xcode installation is incomplete; a full installation is necessary for iOS development.
      Download at: https://developer.apple.com/xcode/download/
      Or install Xcode via the App Store.
      Once installed, run:
        sudo xcode-select --switch /Applications/Xcode.app/Contents/Developer
    ✗ libimobiledevice and ideviceinstaller are not installed. To install with Brew, run:
        brew update
        brew install --HEAD usbmuxd
        brew link usbmuxd
        brew install --HEAD libimobiledevice
        brew install ideviceinstaller
    ✗ ios-deploy not installed. To install:
        brew install ios-deploy
[!] Android Studio (version 3.4)
    ✗ Flutter plugin not installed; this adds Flutter specific functionality.
    ✗ Dart plugin not installed; this adds Dart specific functionality.
[!] Connected device
    ! No devices available

! Doctor found issues in 4 categories.
</code></pre>

<h3>4.安装XCode和打开iOS模拟器</h3>

<ul>
<li><p>安装XCode</p>

<ul>
<li><p>我机器安装的XCode版本是10.2.1，比较新了。如果安装的版本较老，可以更新下</p>

<pre><code>  ksnowlvdeMacBook-Pro:flutter ksnowlv$ sudo xcode-select --switch /Applications/Xcode.app/Contents/Developer
          Password:
</code></pre></li>
</ul>
</li>
<li><p>打开模拟器</p>

<ul>
<li>在Mac机器上，可以通过    <code>open -a Simulator</code></li>
</ul>
</li>
</ul>


<h3>5.创建工程</h3>

<p>使用<code>flutter create 项目名称</code>创建项目</p>

<pre><code>在使用 flutter create命令创建flutter工程时，如果报Cannot create a project within the Flutter SDK. Target directory '/Users/ksnowlv/Music/flutter/flutter/my_app' is within the Flutter SDK at '/Users/ksnowlv/Music/flutter/flutter'的错误，注意不要在flutter SDK目录及子目录下创建工程，可考虑在其它目录下创建工程。例如平级目录
</code></pre>

<h3>6.运行工程</h3>

<p> 使用flutter run运行app，</p>

<pre><code>../flutter/bin/flutter run
</code></pre>

<p><img src="/images/post/2019-05-22-flutteran-zhuang-he-yun-xing/flutter-run_cmd.png" alt="image" /></p>

<p><img src="/images/post/2019-05-22-flutteran-zhuang-he-yun-xing/flutter-run_iOS.png" alt="image" /></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/05/16/swiftfan-xing/">Swift泛型</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2019-05-16T19:53:00+08:00" pubdate data-updated="true">May 16<span>th</span>, 2019</time>
        
         | <a href="/blog/2019/05/16/swiftfan-xing/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="c1">/// 交换两个对象的值</span>
</span><span class='line'><span class="c1">///</span>
</span><span class='line'><span class="c1">/// - Parameters:</span>
</span><span class='line'><span class="c1">///   - aValue: 对象a</span>
</span><span class='line'><span class="c1">///   - bValue: 对象b</span>
</span><span class='line'><span class="n">func</span> <span class="n">swapValues</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span> <span class="nl">aValue:</span> <span class="n">inout</span> <span class="n">T</span><span class="p">,</span> <span class="n">_</span> <span class="nl">bValue:</span> <span class="n">inout</span> <span class="n">T</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">let</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">aValue</span>
</span><span class='line'>    <span class="n">aValue</span> <span class="o">=</span> <span class="n">bValue</span>
</span><span class='line'>    <span class="n">bValue</span> <span class="o">=</span> <span class="n">temp</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">/// 栈模板</span>
</span><span class='line'><span class="k">struct</span> <span class="n">QStack</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">var</span> <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">T</span><span class="p">]()</span>
</span><span class='line'>    <span class="n">mutating</span> <span class="n">func</span> <span class="n">push</span><span class="p">(</span><span class="n">_</span> <span class="nl">item:</span> <span class="n">T</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">items</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">mutating</span> <span class="n">func</span> <span class="n">pop</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">T</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">removeLast</span><span class="p">()</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">func</span> <span class="n">isEmpty</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Bool</span> <span class="p">{</span>
</span><span class='line'>       <span class="k">return</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">self</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">count</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">var</span> <span class="nl">count:</span> <span class="n">Int</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">count</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">subscript</span><span class="p">(</span><span class="nl">i:</span> <span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/05/15/pythonshai-xuan-mu-lu-xia-fei-jpeg%2Cpng%2Cbmpge-shi-de-tu-pian/">Python筛选目录下非jpeg，png，bmp格式的图片</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2019-05-15T20:01:00+08:00" pubdate data-updated="true">May 15<span>th</span>, 2019</time>
        
         | <a href="/blog/2019/05/15/pythonshai-xuan-mu-lu-xia-fei-jpeg%2Cpng%2Cbmpge-shi-de-tu-pian/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p> 功能：筛选指定目录下非jpeg/png/bmp格式的文件，并把路径以日志形式输出。</p>

<p>关键有两点：</p>

<ul>
<li>目录遍历，记录所有文件路径。</li>
<li>遍历路径，使用imghdr.what判断文件格式，非jpeg/png/bmp格式的文件路径输出。</li>
</ul>


<p><code>python3.0</code>实现如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">os</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">imghdr</span>
</span><span class='line'>
</span><span class='line'><span class="c">##工具功能：筛选目录下非jpeg，png，bmp格式的图片，并输出其路径</span>
</span><span class='line'><span class="c">##Python 3.0</span>
</span><span class='line'>
</span><span class='line'><span class="c">#图片文件夹目录</span>
</span><span class='line'><span class="n">IMAGEPATH</span> <span class="o">=</span> <span class="bp">None</span>
</span><span class='line'>
</span><span class='line'><span class="c">#初始化</span>
</span><span class='line'><span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
</span><span class='line'>    <span class="k">global</span> <span class="n">IMAGEPATH</span>
</span><span class='line'>    <span class="n">IMAGEPATH</span>  <span class="o">=</span> <span class="s">&quot;/Users/ksnowlv/Documents/image&quot;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c"># 功能：读取指定目录下的所有文件绝对路径（包括该目录下所有子目录），并以列表形式返回</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">readDir</span><span class="p">(</span><span class="n">dirPath</span><span class="p">):</span>
</span><span class='line'>    <span class="n">myDirPath</span> <span class="o">=</span> <span class="n">dirPath</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">dirPath</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">):</span><span class="c"># 要求传入的路径参数最后不能有斜杠,目的是为了递归时格式统一</span>
</span><span class='line'>        <span class="n">myDirPath</span> <span class="o">=</span> <span class="n">dirPath</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="k">print</span><span class="p">(</span><span class="s">&#39;文件夹路径末尾删除/ = </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">myDirPath</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">allFiles</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">myDirPath</span><span class="p">):</span>
</span><span class='line'>        <span class="n">fileList</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">myDirPath</span><span class="p">)</span>
</span><span class='line'>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fileList</span><span class="p">:</span>
</span><span class='line'>            <span class="n">f</span> <span class="o">=</span> <span class="n">myDirPath</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="o">+</span><span class="n">f</span>
</span><span class='line'>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
</span><span class='line'>                <span class="n">subFiles</span> <span class="o">=</span> <span class="n">readDir</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span class='line'>                <span class="n">allFiles</span> <span class="o">=</span> <span class="n">subFiles</span> <span class="o">+</span> <span class="n">allFiles</span> <span class="c">#合并当前目录与子目录的所有文件路径</span>
</span><span class='line'>            <span class="k">else</span><span class="p">:</span>
</span><span class='line'>                <span class="n">allFiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">allFiles</span>
</span><span class='line'>    <span class="k">else</span><span class="p">:</span>
</span><span class='line'>        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Error,not a dir&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">allFiles</span>
</span><span class='line'>
</span><span class='line'><span class="c">#根据路径筛选出非目标图片的路径</span>
</span><span class='line'><span class="k">def</span> <span class="nf">filterPicture</span><span class="p">(</span><span class="n">fileList</span><span class="p">):</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">fileName</span> <span class="ow">in</span> <span class="n">fileList</span><span class="p">:</span>
</span><span class='line'>        <span class="c"># data = open(fileName, &#39;rb&#39;).read(20)</span>
</span><span class='line'>        <span class="n">fileType</span> <span class="o">=</span> <span class="n">imghdr</span><span class="o">.</span><span class="n">what</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
</span><span class='line'>        <span class="c"># print(&quot;filename = %s fileType = %s&quot; % (fileName,fileType))</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="n">fileType</span> <span class="o">!=</span> <span class="s">&quot;jpeg&quot;</span> <span class="ow">and</span> <span class="n">fileType</span> <span class="o">!=</span> <span class="s">&quot;png&quot;</span> <span class="ow">and</span> <span class="n">fileType</span> <span class="o">!=</span> <span class="s">&quot;bmp&quot;</span><span class="p">:</span>
</span><span class='line'>            <span class="k">print</span><span class="p">(</span><span class="s">&quot;filename = </span><span class="si">%s</span><span class="s"> can not parse fileType = </span><span class="si">%s</span><span class="s"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">fileType</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span><span class='line'>    <span class="n">init</span><span class="p">()</span>
</span><span class='line'>    <span class="n">fileList</span> <span class="o">=</span> <span class="n">readDir</span><span class="p">(</span><span class="n">IMAGEPATH</span><span class="p">)</span>
</span><span class='line'>    <span class="n">filterPicture</span><span class="p">(</span><span class="n">fileList</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">main</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/05/05/kotlin-native/">Kotlin-native</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2019-05-05T15:09:00+08:00" pubdate data-updated="true">May 5<span>th</span>, 2019</time>
        
         | <a href="/blog/2019/05/05/kotlin-native/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content">
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/04/25/kotlintong-guo-jnijian-jie-diao-yong-c-plus-plus/">Kotlin通过jni间接调用c++</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2019-04-25T19:44:00+08:00" pubdate data-updated="true">Apr 25<span>th</span>, 2019</time>
        
         | <a href="/blog/2019/04/25/kotlintong-guo-jnijian-jie-diao-yong-c-plus-plus/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>本篇重点内容，Kotlin通过JNI直接调用C，C调用C++相关的类。实际上只是JAVA换成Kotlin的写法而已。</p>

<h3>一.添加Kotlin类<code>KotlinPerson</code></h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="k">class</span> <span class="nc">KotlinPerson</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">var</span> <span class="n">mPerson</span><span class="p">:</span> <span class="n">Long</span> <span class="p">=</span> <span class="m">0</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">init</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">mPerson</span> <span class="p">=</span> <span class="n">createPerson</span><span class="p">()</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">fun</span> <span class="nf">setPersonName</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">setName</span><span class="p">(</span><span class="n">mPerson</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">fun</span> <span class="nf">personName</span><span class="p">():</span> <span class="n">String</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nf">name</span><span class="p">(</span><span class="n">mPerson</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="k">fun</span> <span class="nf">setPersonAge</span><span class="p">(</span><span class="n">age</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">setAge</span><span class="p">(</span><span class="n">mPerson</span><span class="p">,</span><span class="n">age</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">fun</span> <span class="nf">personAge</span><span class="p">()</span> <span class="p">:</span> <span class="n">Int</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nf">age</span><span class="p">(</span><span class="n">mPerson</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">companion</span> <span class="n">object</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">init</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">System</span><span class="p">.</span><span class="n">loadLibrary</span><span class="p">(</span><span class="s">&quot;JNIPerson&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">external</span> <span class="k">fun</span> <span class="nf">createPerson</span><span class="p">():</span> <span class="n">Long</span>
</span><span class='line'>    <span class="n">external</span> <span class="k">fun</span> <span class="nf">destroyPerson</span><span class="p">(</span><span class="n">person</span><span class="p">:</span> <span class="n">Long</span><span class="p">)</span>
</span><span class='line'>    <span class="n">external</span> <span class="k">fun</span> <span class="nf">setName</span><span class="p">(</span><span class="n">person</span><span class="p">:</span> <span class="n">Long</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span>
</span><span class='line'>    <span class="n">external</span> <span class="k">fun</span> <span class="nf">name</span><span class="p">(</span><span class="n">person</span><span class="p">:</span> <span class="n">Long</span><span class="p">):</span> <span class="n">String</span>
</span><span class='line'>    <span class="n">external</span> <span class="k">fun</span> <span class="nf">setAge</span><span class="p">(</span><span class="n">person</span><span class="p">:</span> <span class="n">Long</span><span class="p">,</span> <span class="n">age</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span>
</span><span class='line'>    <span class="n">external</span> <span class="k">fun</span> <span class="nf">age</span><span class="p">(</span><span class="n">person</span><span class="p">:</span> <span class="n">Long</span><span class="p">):</span> <span class="n">Int</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>二.添加JNI接口及实现</h3>

<p><code>JNIPerson.c</code>内容如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'>  <span class="err">#</span><span class="n">include</span> <span class="s">&quot;JNIPerson.h&quot;</span>
</span><span class='line'>  <span class="err">#</span><span class="n">include</span> <span class="s">&quot;PersonExtension.hpp&quot;</span>
</span><span class='line'>  <span class="err">#</span><span class="n">include</span> <span class="s">&quot;JNILog.h&quot;</span>
</span><span class='line'>  <span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">stdlib</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">string</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
</span><span class='line'>  
</span><span class='line'>  
</span><span class='line'>    <span class="cm">/*</span>
</span><span class='line'><span class="cm">    * Class:     com_ksnowlv_hellojniforjava_JavaCallJNI</span>
</span><span class='line'><span class="cm">    * Method:    createPerson</span>
</span><span class='line'><span class="cm">    * Signature: ()Ljava/lang/Object;</span>
</span><span class='line'><span class="cm">    */</span>
</span><span class='line'>  <span class="n">JNIEXPORT</span> <span class="n">jlong</span> <span class="n">JNICALL</span> <span class="n">Java_com_ksnowlv_kotlinjni_KotlinPerson_createPerson</span>
</span><span class='line'>      <span class="p">(</span><span class="n">JNIEnv</span> <span class="o">*</span><span class="n">env</span><span class="p">,</span> <span class="n">jobject</span> <span class="n">cls</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  
</span><span class='line'>  
</span><span class='line'>        <span class="kt">void</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">createPerson</span><span class="p">();</span>
</span><span class='line'>  
</span><span class='line'>        <span class="k">return</span> <span class="p">(</span><span class="n">jlong</span><span class="p">)</span><span class="n">p</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>    <span class="cm">/*</span>
</span><span class='line'><span class="cm">    * Class:     com_ksnowlv_hellojniforjava_JavaCallJNI</span>
</span><span class='line'><span class="cm">    * Method:    destroyPerson</span>
</span><span class='line'><span class="cm">    * Signature: (Ljava/lang/Object;)V</span>
</span><span class='line'><span class="cm">    */</span>
</span><span class='line'>    <span class="n">JNIEXPORT</span> <span class="kt">void</span> <span class="n">JNICALL</span> <span class="n">Java_com_ksnowlv_kotlinjni_KotlinPerson_destroyPerson</span>
</span><span class='line'>      <span class="p">(</span><span class="n">JNIEnv</span> <span class="o">*</span><span class="n">env</span><span class="p">,</span> <span class="n">jobject</span> <span class="n">cls</span><span class="p">,</span> <span class="n">jlong</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  
</span><span class='line'>          <span class="n">destroyPerson</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">o</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>    <span class="cm">/*</span>
</span><span class='line'><span class="cm">    * Class:     com_ksnowlv_hellojniforjava_JavaCallJNI</span>
</span><span class='line'><span class="cm">    * Method:    setPersonAge</span>
</span><span class='line'><span class="cm">    * Signature: (Ljava/lang/Object;I)V</span>
</span><span class='line'><span class="cm">    */</span>
</span><span class='line'>    <span class="n">JNIEXPORT</span> <span class="kt">void</span> <span class="n">JNICALL</span> <span class="n">Java_com_ksnowlv_kotlinjni_KotlinPerson_setAge</span>
</span><span class='line'>      <span class="p">(</span><span class="n">JNIEnv</span> <span class="o">*</span><span class="n">env</span><span class="p">,</span> <span class="n">jobject</span> <span class="n">cls</span><span class="p">,</span> <span class="n">jlong</span> <span class="n">o</span><span class="p">,</span> <span class="n">jint</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">setPersonAge</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">o</span><span class="p">,</span><span class="n">value</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>    <span class="cm">/*</span>
</span><span class='line'><span class="cm">    * Class:     com_ksnowlv_hellojniforjava_JavaCallJNI</span>
</span><span class='line'><span class="cm">    * Method:    personAge</span>
</span><span class='line'><span class="cm">    * Signature: (Ljava/lang/Object;)I</span>
</span><span class='line'><span class="cm">    */</span>
</span><span class='line'>    <span class="n">JNIEXPORT</span> <span class="n">jint</span> <span class="n">JNICALL</span> <span class="n">Java_com_ksnowlv_kotlinjni_KotlinPerson_age</span>
</span><span class='line'>      <span class="p">(</span><span class="n">JNIEnv</span> <span class="o">*</span><span class="n">env</span><span class="p">,</span> <span class="n">jobject</span> <span class="n">cls</span><span class="p">,</span> <span class="n">jlong</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>       <span class="k">return</span> <span class="n">personAge</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">o</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  
</span><span class='line'>    <span class="n">JNIEXPORT</span> <span class="kt">void</span> <span class="n">JNICALL</span> <span class="n">Java_com_ksnowlv_kotlinjni_KotlinPerson_setName</span>
</span><span class='line'>      <span class="p">(</span><span class="n">JNIEnv</span> <span class="o">*</span><span class="n">env</span><span class="p">,</span> <span class="n">jobject</span> <span class="n">cls</span><span class="p">,</span> <span class="n">jlong</span> <span class="n">o</span><span class="p">,</span> <span class="n">jstring</span> <span class="n">string</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  
</span><span class='line'>        <span class="kt">int</span> <span class="n">length1</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetStringLength</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">string</span><span class="p">);</span>
</span><span class='line'>        <span class="k">const</span> <span class="n">jchar</span> <span class="o">*</span> <span class="n">jcstr</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetStringChars</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span><span class='line'>  
</span><span class='line'>  
</span><span class='line'>         <span class="n">jclass</span>   <span class="n">clsstring</span>   <span class="o">=</span>   <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">FindClass</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="s">&quot;java/lang/String&quot;</span><span class="p">);</span>  <span class="c1">//String</span>
</span><span class='line'>         <span class="n">jstring</span>   <span class="n">code</span>   <span class="o">=</span>   <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">NewStringUTF</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="s">&quot;UTF-8&quot;</span><span class="p">);</span> <span class="c1">//&quot;UTF-8&quot;</span>
</span><span class='line'>         <span class="n">jmethodID</span>   <span class="n">methodID</span>   <span class="o">=</span>   <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetMethodID</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="n">clsstring</span><span class="p">,</span>   <span class="s">&quot;getBytes&quot;</span><span class="p">,</span>   <span class="s">&quot;(Ljava/lang/String;)[B&quot;</span><span class="p">);</span> <span class="c1">//getBytes();</span>
</span><span class='line'>         <span class="n">jbyteArray</span>   <span class="n">byteArray</span> <span class="o">=</span>   <span class="p">(</span><span class="n">jbyteArray</span><span class="p">)(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">CallObjectMethod</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="n">string</span><span class="p">,</span><span class="n">methodID</span><span class="p">,</span><span class="n">code</span><span class="p">);</span>
</span><span class='line'>         <span class="n">jsize</span>   <span class="n">length</span>   <span class="o">=</span>   <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetArrayLength</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="n">byteArray</span><span class="p">);</span>
</span><span class='line'>         <span class="n">jbyte</span><span class="o">*</span>   <span class="n">bytes</span>   <span class="o">=</span>   <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetByteArrayElements</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="n">byteArray</span><span class="p">,</span><span class="n">JNI_FALSE</span><span class="p">);</span>
</span><span class='line'>  
</span><span class='line'>  
</span><span class='line'>         <span class="k">if</span><span class="p">(</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
</span><span class='line'>  
</span><span class='line'>            <span class="kt">char</span><span class="o">*</span> <span class="n">buf</span> <span class="o">=</span>   <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">length</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>         <span class="c1">//&quot;\0&quot;</span>
</span><span class='line'>            <span class="n">memcpy</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="n">bytes</span><span class="p">,</span><span class="n">length</span><span class="p">);</span>
</span><span class='line'>            <span class="n">buf</span><span class="p">[</span><span class="n">length</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>            <span class="n">setPersonName</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">o</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
</span><span class='line'>            <span class="n">LOGI</span><span class="p">(</span><span class="s">&quot;set name = %s&quot;</span><span class="p">,</span><span class="n">buf</span><span class="p">);</span>
</span><span class='line'>            <span class="n">free</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
</span><span class='line'>         <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>            <span class="n">setPersonName</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">o</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span><span class='line'>         <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>         <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">ReleaseByteArrayElements</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="n">byteArray</span><span class="p">,</span><span class="n">bytes</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>  <span class="c1">//释放内存空间</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>    <span class="cm">/*</span>
</span><span class='line'><span class="cm">    * Class:     com_ksnowlv_hellojniforjava_JavaCallJNI</span>
</span><span class='line'><span class="cm">    * Method:    personName</span>
</span><span class='line'><span class="cm">    * Signature: (Ljava/lang/Object;)Ljava/lang/String;</span>
</span><span class='line'><span class="cm">    */</span>
</span><span class='line'>    <span class="n">JNIEXPORT</span> <span class="n">jstring</span> <span class="n">JNICALL</span> <span class="n">Java_com_ksnowlv_kotlinjni_KotlinPerson_name</span>
</span><span class='line'>      <span class="p">(</span><span class="n">JNIEnv</span> <span class="o">*</span><span class="n">env</span><span class="p">,</span> <span class="n">jobject</span> <span class="n">cls</span><span class="p">,</span> <span class="n">jlong</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  
</span><span class='line'>        <span class="n">LOGI</span><span class="p">(</span><span class="s">&quot;jni get name&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span> <span class="o">=</span> <span class="n">personName</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">o</span><span class="p">);</span>
</span><span class='line'>  
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span> <span class="n">name</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">LOGI</span><span class="p">(</span><span class="s">&quot;jni name = %s&quot;</span><span class="p">,</span><span class="n">name</span><span class="p">);</span>
</span><span class='line'>            <span class="k">return</span>  <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">NewStringUTF</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="n">name</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">NewStringUTF</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="err">#</span><span class="n">include</span> <span class="s">&quot;JNIPerson.h&quot;</span>
</span><span class='line'><span class="cp">#include &quot;PersonExtension.hpp&quot;</span>
</span><span class='line'><span class="cp">#include &quot;JNILog.h&quot;</span>
</span><span class='line'><span class="cp">#include &lt;stdlib.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;string.h&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/*</span>
</span><span class='line'><span class="cm">   * Class:     com_ksnowlv_hellojniforjava_JavaCallJNI</span>
</span><span class='line'><span class="cm">   * Method:    createPerson</span>
</span><span class='line'><span class="cm">   * Signature: ()Ljava/lang/Object;</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'><span class="n">JNIEXPORT</span> <span class="n">jlong</span> <span class="n">JNICALL</span> <span class="n">Java_com_ksnowlv_kotlinjni_KotlinPerson_createPerson</span>
</span><span class='line'>    <span class="p">(</span><span class="n">JNIEnv</span> <span class="o">*</span><span class="n">env</span><span class="p">,</span> <span class="n">jobject</span> <span class="n">cls</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>      <span class="kt">void</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">createPerson</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">return</span> <span class="p">(</span><span class="n">jlong</span><span class="p">)</span><span class="n">p</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/*</span>
</span><span class='line'><span class="cm">   * Class:     com_ksnowlv_hellojniforjava_JavaCallJNI</span>
</span><span class='line'><span class="cm">   * Method:    destroyPerson</span>
</span><span class='line'><span class="cm">   * Signature: (Ljava/lang/Object;)V</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="n">JNIEXPORT</span> <span class="kt">void</span> <span class="n">JNICALL</span> <span class="n">Java_com_ksnowlv_kotlinjni_KotlinPerson_destroyPerson</span>
</span><span class='line'>    <span class="p">(</span><span class="n">JNIEnv</span> <span class="o">*</span><span class="n">env</span><span class="p">,</span> <span class="n">jobject</span> <span class="n">cls</span><span class="p">,</span> <span class="n">jlong</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">destroyPerson</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">o</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/*</span>
</span><span class='line'><span class="cm">   * Class:     com_ksnowlv_hellojniforjava_JavaCallJNI</span>
</span><span class='line'><span class="cm">   * Method:    setPersonAge</span>
</span><span class='line'><span class="cm">   * Signature: (Ljava/lang/Object;I)V</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="n">JNIEXPORT</span> <span class="kt">void</span> <span class="n">JNICALL</span> <span class="n">Java_com_ksnowlv_kotlinjni_KotlinPerson_setAge</span>
</span><span class='line'>    <span class="p">(</span><span class="n">JNIEnv</span> <span class="o">*</span><span class="n">env</span><span class="p">,</span> <span class="n">jobject</span> <span class="n">cls</span><span class="p">,</span> <span class="n">jlong</span> <span class="n">o</span><span class="p">,</span> <span class="n">jint</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">setPersonAge</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">o</span><span class="p">,</span><span class="n">value</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/*</span>
</span><span class='line'><span class="cm">   * Class:     com_ksnowlv_hellojniforjava_JavaCallJNI</span>
</span><span class='line'><span class="cm">   * Method:    personAge</span>
</span><span class='line'><span class="cm">   * Signature: (Ljava/lang/Object;)I</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="n">JNIEXPORT</span> <span class="n">jint</span> <span class="n">JNICALL</span> <span class="n">Java_com_ksnowlv_kotlinjni_KotlinPerson_age</span>
</span><span class='line'>    <span class="p">(</span><span class="n">JNIEnv</span> <span class="o">*</span><span class="n">env</span><span class="p">,</span> <span class="n">jobject</span> <span class="n">cls</span><span class="p">,</span> <span class="n">jlong</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>     <span class="k">return</span> <span class="n">personAge</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">o</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="n">JNIEXPORT</span> <span class="kt">void</span> <span class="n">JNICALL</span> <span class="n">Java_com_ksnowlv_kotlinjni_KotlinPerson_setName</span>
</span><span class='line'>    <span class="p">(</span><span class="n">JNIEnv</span> <span class="o">*</span><span class="n">env</span><span class="p">,</span> <span class="n">jobject</span> <span class="n">cls</span><span class="p">,</span> <span class="n">jlong</span> <span class="n">o</span><span class="p">,</span> <span class="n">jstring</span> <span class="n">string</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>      <span class="kt">int</span> <span class="n">length1</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetStringLength</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">string</span><span class="p">);</span>
</span><span class='line'>      <span class="k">const</span> <span class="n">jchar</span> <span class="o">*</span> <span class="n">jcstr</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetStringChars</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>       <span class="n">jclass</span>   <span class="n">clsstring</span>   <span class="o">=</span>   <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">FindClass</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="s">&quot;java/lang/String&quot;</span><span class="p">);</span>  <span class="c1">//String</span>
</span><span class='line'>       <span class="n">jstring</span>   <span class="n">code</span>   <span class="o">=</span>   <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">NewStringUTF</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="s">&quot;UTF-8&quot;</span><span class="p">);</span> <span class="c1">//&quot;UTF-8&quot;</span>
</span><span class='line'>       <span class="n">jmethodID</span>   <span class="n">methodID</span>   <span class="o">=</span>   <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetMethodID</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="n">clsstring</span><span class="p">,</span>   <span class="s">&quot;getBytes&quot;</span><span class="p">,</span>   <span class="s">&quot;(Ljava/lang/String;)[B&quot;</span><span class="p">);</span> <span class="c1">//getBytes();</span>
</span><span class='line'>       <span class="n">jbyteArray</span>   <span class="n">byteArray</span> <span class="o">=</span>   <span class="p">(</span><span class="n">jbyteArray</span><span class="p">)(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">CallObjectMethod</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="n">string</span><span class="p">,</span><span class="n">methodID</span><span class="p">,</span><span class="n">code</span><span class="p">);</span>
</span><span class='line'>       <span class="n">jsize</span>   <span class="n">length</span>   <span class="o">=</span>   <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetArrayLength</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="n">byteArray</span><span class="p">);</span>
</span><span class='line'>       <span class="n">jbyte</span><span class="o">*</span>   <span class="n">bytes</span>   <span class="o">=</span>   <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetByteArrayElements</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="n">byteArray</span><span class="p">,</span><span class="n">JNI_FALSE</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>       <span class="k">if</span><span class="p">(</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
</span><span class='line'>
</span><span class='line'>          <span class="kt">char</span><span class="o">*</span> <span class="n">buf</span> <span class="o">=</span>   <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">length</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>         <span class="c1">//&quot;\0&quot;</span>
</span><span class='line'>          <span class="n">memcpy</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="n">bytes</span><span class="p">,</span><span class="n">length</span><span class="p">);</span>
</span><span class='line'>          <span class="n">buf</span><span class="p">[</span><span class="n">length</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>          <span class="n">setPersonName</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">o</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
</span><span class='line'>          <span class="n">LOGI</span><span class="p">(</span><span class="s">&quot;set name = %s&quot;</span><span class="p">,</span><span class="n">buf</span><span class="p">);</span>
</span><span class='line'>          <span class="n">free</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
</span><span class='line'>       <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>          <span class="n">setPersonName</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">o</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span><span class='line'>       <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>       <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">ReleaseByteArrayElements</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="n">byteArray</span><span class="p">,</span><span class="n">bytes</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>  <span class="c1">//释放内存空间</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/*</span>
</span><span class='line'><span class="cm">   * Class:     com_ksnowlv_hellojniforjava_JavaCallJNI</span>
</span><span class='line'><span class="cm">   * Method:    personName</span>
</span><span class='line'><span class="cm">   * Signature: (Ljava/lang/Object;)Ljava/lang/String;</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="n">JNIEXPORT</span> <span class="n">jstring</span> <span class="n">JNICALL</span> <span class="n">Java_com_ksnowlv_kotlinjni_KotlinPerson_name</span>
</span><span class='line'>    <span class="p">(</span><span class="n">JNIEnv</span> <span class="o">*</span><span class="n">env</span><span class="p">,</span> <span class="n">jobject</span> <span class="n">cls</span><span class="p">,</span> <span class="n">jlong</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">LOGI</span><span class="p">(</span><span class="s">&quot;jni get name&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span> <span class="o">=</span> <span class="n">personName</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">o</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span> <span class="n">name</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">LOGI</span><span class="p">(</span><span class="s">&quot;jni name = %s&quot;</span><span class="p">,</span><span class="n">name</span><span class="p">);</span>
</span><span class='line'>          <span class="k">return</span>  <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">NewStringUTF</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="n">name</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">return</span> <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">NewStringUTF</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>三.调用</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="k">var</span> <span class="n">person</span> <span class="p">=</span> <span class="n">KotlinPerson</span><span class="p">()</span>
</span><span class='line'><span class="n">person</span><span class="p">.</span><span class="n">setPersonAge</span><span class="p">(</span><span class="m">10</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">Log</span><span class="p">.</span><span class="n">i</span><span class="p">(</span><span class="s">&quot;----Android age = &quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span> <span class="p">+</span> <span class="n">person</span><span class="p">.</span><span class="n">personAge</span><span class="p">())</span>
</span><span class='line'><span class="n">person</span><span class="p">.</span><span class="n">setPersonName</span><span class="p">(</span><span class="s">&quot;ksnowlv(律威)&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">Log</span><span class="p">.</span><span class="n">i</span><span class="p">(</span><span class="s">&quot;----Android name = &quot;</span><span class="p">,</span> <span class="n">person</span><span class="p">.</span><span class="n">personName</span><span class="p">())</span>
</span></code></pre></td></tr></table></div></figure>


<h3>四.日志输出</h3>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>关于我</h1>
  <p>微信公众号:ksnowlv</p>
  <p>聚集于移动互联网开发和金融</p>
  <p>在腾讯，阿里，搜狗等互联网公司从事多年移动端开发</p>
  <p>能做一点,是一点;不求大成,不求一万年;积少成多,水到渠成!</p>
</section>
<section>
  <h1>最近发布</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2019/11/29/macan-zhuang-maven/">Mac安装Maven</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/11/28/iosshi-pin-bo-fang-avplayerviewcontroller/">iOS视频播放AVPlayerViewController</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/11/26/iosshi-pin-bo-fang-avplayer/">iOS视频播放-AVPlayer和AVPlayerLayer</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/08/19/xcodeshi-yong-pmdsao-miao-zhong-fu-dai-ma/">XCode使用PMD扫描重复代码（一）</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/05/22/flutter-cannot-create-a-project-within-the-flutter-sdk/">flutter创建工程报错:Cannot create a project within the Flutter SDK. Target directory &#8216;x&#8217; is within the Flutter SDK at&#8217;/Users/x/Music/flutter/flutter&#8217;</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>分类</h1>
    <ul id="category-list"><li><a href='/blog/categories/android-jni/'>Android-jni (6)</a></li><li><a href='/blog/categories/android-qi-ta/'>Android-其它 (2)</a></li><li><a href='/blog/categories/android-duo-xian-cheng/'>Android-多线程 (3)</a></li><li><a href='/blog/categories/android-wang-luo/'>Android-网络 (2)</a></li><li><a href='/blog/categories/c-plus-plus/'>C++ (2)</a></li><li><a href='/blog/categories/flutter/'>flutter (2)</a></li><li><a href='/blog/categories/git/'>git (6)</a></li><li><a href='/blog/categories/github-bo-ke/'>github-博客 (9)</a></li><li><a href='/blog/categories/go/'>go (1)</a></li><li><a href='/blog/categories/ios-opengl/'>iOS-OpenGL (2)</a></li><li><a href='/blog/categories/ios-ui/'>iOS-UI (10)</a></li><li><a href='/blog/categories/ios-you-hua/'>iOS-优化 (2)</a></li><li><a href='/blog/categories/ios-nei-cun/'>iOS-内存 (5)</a></li><li><a href='/blog/categories/ios-ji-chu/'>iOS-基础 (33)</a></li><li><a href='/blog/categories/ios-duo-xian-cheng/'>iOS-多线程 (6)</a></li><li><a href='/blog/categories/ios-cun-chu/'>iOS-存储 (1)</a></li><li><a href='/blog/categories/ios-wang-luo/'>iOS-网络 (13)</a></li><li><a href='/blog/categories/ios-she-ji-mo-shi/'>iOS-设计模式 (1)</a></li><li><a href='/blog/categories/iosshen-he/'>iOS审核 (1)</a></li><li><a href='/blog/categories/javahou-tai/'>java后台 (3)</a></li><li><a href='/blog/categories/kotlin/'>Kotlin (1)</a></li><li><a href='/blog/categories/mac/'>Mac (5)</a></li><li><a href='/blog/categories/nginx/'>nginx (3)</a></li><li><a href='/blog/categories/php/'>php (3)</a></li><li><a href='/blog/categories/python/'>python (12)</a></li><li><a href='/blog/categories/python/'>Python (1)</a></li><li><a href='/blog/categories/swift-ji-chu-kuang-jia/'>swift-基础框架 (25)</a></li><li><a href='/blog/categories/swift-ji-chu-zhi-shi/'>swift-基础知识 (19)</a></li><li><a href='/blog/categories/swift-shi-pin/'>swift-视频 (2)</a></li><li><a href='/blog/categories/symbian-jie-ya-suo/'>symbian-解压缩 (1)</a></li><li><a href='/blog/categories/uml/'>UML (8)</a></li><li><a href='/blog/categories/xcode/'>Xcode (12)</a></li><li><a href='/blog/categories/chan-pin-she-ji/'>产品设计 (2)</a></li><li><a href='/blog/categories/an-quan/'>安全 (8)</a></li><li><a href='/blog/categories/gong-ju/'>工具 (1)</a></li><li><a href='/blog/categories/tou-zi-li-cai/'>投资理财 (1)</a></li><li><a href='/blog/categories/shu-ju-ku/'>数据库 (3)</a></li><li><a href='/blog/categories/sheng-huo-pian-duan/'>生活片段 (7)</a></li><li><a href='/blog/categories/suan-fa-yu-shu-ju-jie-gou/'>算法与数据结构 (1)</a></li><li><a href='/blog/categories/wang-luo/'>网络 (2)</a></li><li><a href='/blog/categories/zhi-ye-sheng-ya/'>职业生涯 (4)</a></li><li><a href='/blog/categories/du-shu/'>读书 (2)</a></li></ul>
</section>
<section>
  <h1>外部链接</h1>
    <ul id="外部链接">
    	<li><a href="https://developer.apple.com">苹果开发者中心</a> </li>
    	<li><a href="http://stackoverflow.com/questions/tagged/ios">stackoverflow</a></li>
    	<li><a href="http://ksnowlv.blog.163.com/blog/#m=0">ksnowlv网易博客</a></li>
    	<li><a href="https://www.jianshu.com/u/6fe5d9875a9e">简书</a></li>
	</ul>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2020 - 律威 -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
  
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1271193933'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s22.cnzz.com/z_stat.php%3Fid%3D1271193933%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));</script>

  <script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F4c1727a94ea20751730e8a556dbdbf82' type='text/javascript'%3E%3C/script%3E"));
</script>

</p>



</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'ksnowlv';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>






Included file 'custom/after_footer.html' not found in _includes directory

</body>
</html>
