<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: XCode | ksnowlv]]></title>
  <link href="http://ksnowlv.github.io/blog/categories/xcode/atom.xml" rel="self"/>
  <link href="http://ksnowlv.github.io/"/>
  <updated>2020-05-22T13:58:52+08:00</updated>
  <id>http://ksnowlv.github.io/</id>
  <author>
    <name><![CDATA[律威]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[XCode使用PMD扫描重复代码（一）]]></title>
    <link href="http://ksnowlv.github.io/blog/2019/08/19/xcodeshi-yong-pmdsao-miao-zhong-fu-dai-ma/"/>
    <updated>2019-08-19T15:39:00+08:00</updated>
    <id>http://ksnowlv.github.io/blog/2019/08/19/xcodeshi-yong-pmdsao-miao-zhong-fu-dai-ma</id>
    <content type="html"><![CDATA[<p>如何使用PMD在XCode下扫描重复代码（Copy&amp;Past）呢？</p>

<h3>1.下载PMD：<a href="https://pmd.github.io">https://pmd.github.io</a>，放置到工程主目录下面。</h3>

<p><img src="/images/post/2019-08-19-xcodeshi-yong-pmdsao-miao-zhong-fu-dai-ma/1.png" alt="image" /></p>

<h3>2.XCode中检测脚本配置</h3>

<h4>1.在<code>Xcode</code>的 <code>Build Phases</code> 中，我们增加一个新的 <code>Run Script</code>，脚本内容如下：</h4>

<pre><code>#检测swift代码
#pmd cpd --files ${EXECUTABLE_NAME} --minimum-tokens 50 --language swift --encoding UTF-8 --format net.sourceforge.pmd.cpd.XMLRenderer &gt; cpd-output.xml --failOnViolation true

#检测objective-c代码
pmd cpd --files ${EXECUTABLE_NAME} --minimum-tokens 20 --language objectivec --encoding UTF-8 --format net.sourceforge.pmd.cpd.XMLRenderer &gt; cpd-output.xml --failOnViolation true

# Running script
php ./cpd_script.php -cpd-xml cpd-output.xml
</code></pre>

<h4>2.在工程主目录下，创建cpd_script.php文件</h4>

<p>！！！需要安装好php</p>

<pre><code>&lt;?php
foreach (simplexml_load_file('cpd-output.xml')-&gt;duplication as $duplication) {
    $files = $duplication-&gt;xpath('file');
    foreach ($files as $file) {
        echo $file['path'].':'.$file['line'].':1: warning: '.$duplication['lines'].' copy-pasted lines from: '
            .implode(', ', array_map(function ($otherFile) { return $otherFile['path'].':'.$otherFile['line']; },
            array_filter($files, function ($f) use (&amp;$file) { return $f != $file; }))).PHP_EOL;
    }
}
?&gt;
</code></pre>

<p><img src="/images/post/2019-08-19-xcodeshi-yong-pmdsao-miao-zhong-fu-dai-ma/2.jpg" alt="image" /></p>
]]></content>
  </entry>
  
</feed>
